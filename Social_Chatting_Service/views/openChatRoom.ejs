<!DOCTYPE html>
<html>
  <head>
    <%- include('header') %>
    <title>Open ChatRoom</title>
    <style>
      .layout_area{
        height: 600px;
        border: solid 1px;
      }
      
      .chatBox_area{
        display: flex;
        margin:10px;
        height: 96%;
      }
      
      .chatting_area{
        display: flex;
        flex-direction: column;
        flex-grow: 3;
        margin:10px;
        height: 96%;
        border: solid 1px;
      }

      .room_no{
        border-bottom: solid 1px;
        height:30px;
        padding-left: 5px;
      }

      .message_area{
        margin:10px;
        height: 450px;
        overflow-y: scroll;
      }
      
      .text_div{
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        margin: 0 5px 5px 5px;
        border: solid 1px;
      }

      .text_area{
        flex-grow: 1;
        resize: none;
      }

      .right_area{
        flex-grow: 1;
      }

      .userList_area{
        display:flex;
        flex-direction: column;
        height: 80%;
        margin: 10px;
        border: solid 1px;
      }

      .userList{
        flex-grow: 1;
        margin: 10px;
        overflow-y: scroll;
        text-align: center;
      }
      
      .exit{
        
        text-align: center;
      }

      .notice_text{
        display: block;
        text-align: center;
      }

      .message_text{
        display: block;
      }

    </style>
  </head>
  <body>
    <%- include('nav') %>

    <div class="container mb-3">
        <div class="jumbotron">
          <div class="layout_area">
            <div class="chatBox_area">
              <div class="chatting_area">
                <div class="room_no">방 번호 : </div>
                <div class="message_area">
                  <span class="notice_text">user01님이 입장하셨습니다</span>
                  <span class="message_text">user01: 안녕하세요</span>
                </div>
                <div class="text_div">
                  <textarea class="text_area"></textarea>
                </div>
              </div>

              <div class="right_area">
                <div class="userList_area">
                  <div style="text-align: center; border-bottom: solid 1px; display:inline-block">현재 인원 : </div>
                  <div class="userList">
                    <ul style="list-style:none;">
                      <li>asdf</li>
                    </ul>
                  </div>
                </div>
                <div class="exit"><button type="button" class="btn btn-primary" style="width: 100px;" id="exit_btn">나가기</button></div>
              </div>
          </div>
        </div>
    </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    $(function(){
      
      socket = io.connect('http://localhost:3000/');

      socket.on("connect", function(data){
      
      console.log("server connect");
      socket.emit('joinRoom', {room:'room1'}); // 방 입장
      
      $('#exit_btn').click(function(){
        socket.emit('')
        window.location.href="/openchat/roomlist";
      });

      // 채팅 메시지 수신
      socket.on('message', function(data){
        var msg = data['msg'];
        var userId = data['userId'];
        var str = userId + ' : ' + msg;
        
        // 메세지 채팅창에 붙이기
        // $('#message_content').append();
        });

      });

    });

    
  </script>
  
  </body>
</html>